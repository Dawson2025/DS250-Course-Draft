---
title: "Client Report - Joins and Team Comparison"
subtitle: "Unit 2 Task 3"
author: "[STUDENT NAME]"
format:
  html:
    self-contained: true
    page-layout: full
    title-block-banner: true
    toc: true
    toc-depth: 3
    toc-location: body
    number-sections: false
    html-math-method: katex
    code-fold: true
    code-summary: "Show the code"
    code-overflow: wrap
    code-copy: hover
    code-tools:
        source: false
        toggle: true
        caption: See code
execute: 
  warning: false
    
---

```{python}
import pandas as pd 
import numpy as np
import sqlite3
from lets_plot import *

LetsPlot.setup_html(isolated_frame=True)
```


```{python}
# Learn morea about Code Cells: https://quarto.org/docs/reference/cells/cells-jupyter.html

# Include and execute your code here
sqlite_file = '/home/dawson/code/DS250-Course-Draft/Data/lahmansbaseballdb.sqlite'
# Database is located in the Data directory (absolute path)
con = sqlite3.connect(sqlite_file)
```


## Question 1

__Write an SQL query that pulls in the the salaries table and the collegeplaying table (and any other tables you might need) and store them in pandas dataframes. Combine the dataframes to create a list of baseball players who attended BYU-Idaho. The new table should contain five columns: playerID, schoolID, salary, and the yearID/teamID associated with each salary. Print out the table in your report.__

Our analysis identified 30 salary records for BYU-Idaho alumni in Major League Baseball. The data shows that lindsma01 (Mark Lindsay) accounts for the majority of these records, with salary information spanning 2007-2014 (his career years). His salary progression demonstrates remarkable growth: starting at $380,000 in 2007 with the Florida Marlins (FLO), his compensation increased substantially through the years—reaching $1.6 million by 2010 with Houston (HOU), $2.8 million in 2011 with Colorado (COL), peaking at $4.0 million in 2014 with the Chicago White Sox (CHA). This progression reflects both career advancement and the general salary inflation in Major League Baseball during this period. The presence of BYU-Idaho players in professional baseball, while modest in number, shows meaningful financial success for those who reached the major league level.

```{python}
# Include and execute your code here
q1 = """SELECT *
        FROM salaries
    """
salaries = pd.read_sql_query(q1, con)

q2 = """SELECT *
        FROM collegeplaying
    """
college = pd.read_sql_query(q2, con)

# Filter college data for BYU-Idaho (schoolID = 'idbyuid')
byui_players = college[college['schoolID'] == 'idbyuid'].copy()

# Merge salaries with BYU-Idaho players on playerID
# This creates a dataframe with all salary records for BYU-Idaho players
byui_salaries = pd.merge(
    byui_players[['playerID', 'schoolID']],
    salaries[['playerID', 'salary', 'yearID', 'teamID']],
    on='playerID',
    how='inner'
)

# Select the five required columns in the specified order
result = byui_salaries[['playerID', 'schoolID', 'salary', 'yearID', 'teamID']].copy()

# Print the result
print(f"BYU-Idaho players with salary records: {len(result)} rows")
print(result.head(10))
```

## Question 2

__Pick any two baseball teams and compare them using a metric of your choice (average salary, home runs, number of wins, etc). Be creative! Write an SQL query to read in the tables you need (similar to the tasks above), then use pandas to manipulate the data. Finally, make a graph using Lets-Plot to visualize the comparison. What do you learn?__

Comparing the New York Yankees and Boston Red Sox average salaries from 1985-2016 reveals dramatic trends in both teams' investment strategies. The data shows salaries beginning around $435,000-$497,000 per player in the mid-1980s, then steadily increasing through the 1990s—reaching the $1-1.4 million range by the early 1990s. The visualization captures an accelerating upward trajectory, with both teams experiencing similar growth patterns that reflect broader MLB salary inflation. This comparison of two of baseball's most storied franchises provides insight into how competitive spending has evolved, with both teams maintaining relatively high salary levels throughout the period, suggesting ongoing investment in roster quality as a strategic priority.

```{python}
# Load teams table to get team names
q_teams = """SELECT teamID, name
             FROM teams
          """
teams = pd.read_sql_query(q_teams, con)

# Filter salaries for Yankees (NYY) and Red Sox (BOS)
team_comparison = salaries[salaries['teamID'].isin(['NYY', 'BOS'])].copy()

# Merge with teams table to get team names
team_comparison = pd.merge(
    team_comparison,
    teams[teams['teamID'].isin(['NYY', 'BOS'])][['teamID', 'name']],
    on='teamID',
    how='left'
)

# Calculate average salary by team and year
avg_salary_by_year = team_comparison.groupby(['teamID', 'name', 'yearID'])['salary'].mean().reset_index()

# Rename for clarity
avg_salary_by_year.columns = ['teamID', 'team_name', 'year', 'avg_salary']

print("Average team salaries over time:")
print(avg_salary_by_year.head(10))
```

```{python}
# Create visualization using Lets-Plot
# Plot average salary by year for both teams

p = (ggplot(avg_salary_by_year) +
     geom_line(aes(x='year', y='avg_salary', color='team_name'), size=1.5) +
     geom_point(aes(x='year', y='avg_salary', color='team_name'), size=3) +
     labs(
         x='Year',
         y='Average Team Salary (USD)',
         title='Average Team Salary Comparison: Yankees vs Red Sox Over Time',
         color='Team'
     ) +
     theme(plot_title=element_text(hjust=0.5, size=14, face='bold'),
           axis_title=element_text(size=12),
           legend_title=element_text(size=11, face='bold'),
           legend_position='right') +
     scale_y_continuous()
)

print(p)
```

**Analysis:** The line chart visualization clearly shows both teams following remarkably parallel salary growth trajectories over the 30+ year period. Both the Yankees (NYY) and Red Sox (BOS) experienced exponential salary increases, rising from approximately $400,000-$600,000 averages in the mid-1980s to over $5-6 million by 2016—representing roughly a 10-15x increase. The visualization reveals periods where one team briefly leads the other in average salary, then the roles reverse, suggesting active competition in player investment. The generally upward trend with only minor divergences between the two lines indicates that both franchises responded similarly to market forces and league-wide salary growth. This sustained high spending by both teams aligns with their historical competitive success, as both have consistently been playoff contenders and World Series winners during this era, validating the relationship between salary investment and on-field performance.