---
title: "Client Report - Longevity of Baseball Players"
subtitle: "Unit 2 Task 3"
author: "[STUDENT NAME]"
format:
  html:
    self-contained: true
    page-layout: full
    title-block-banner: true
    toc: true
    toc-depth: 3
    toc-location: body
    number-sections: false
    html-math-method: katex
    code-fold: true
    code-summary: "Show the code"
    code-overflow: wrap
    code-copy: hover
    code-tools:
        source: false
        toggle: true
        caption: See code
execute: 
  warning: false
    
---

```{python}
import pandas as pd 
import numpy as np
import sqlite3
from lets_plot import *

LetsPlot.setup_html(isolated_frame=True)
```


```{python}
# Learn morea about Code Cells: https://quarto.org/docs/reference/cells/cells-jupyter.html

# Include and execute your code here
sqlite_file = 'lahmansbaseballdb.sqlite'
# this file must be in the same location as your .qmd or .py file
con = sqlite3.connect(sqlite_file)
```

## QUESTION 1

__Identify the top 10 players with the longest careers. Include their:__

    - playerID
    - first_name
    - last_name
    - career_length

The analysis identifies the top 10 players with the longest careers in Major League Baseball (MLB). Career length is calculated as the difference between the last year and first year a player appeared in the batting table, plus 1 to include both years.

```{python}
# SQL query to find top 10 players with longest careers
query = """
SELECT p.playerID,
       p.nameFirst as first_name,
       p.nameLast as last_name,
       (MAX(b.yearID) - MIN(b.yearID) + 1) as career_length
FROM people p
JOIN batting b ON p.playerID = b.playerID
GROUP BY p.playerID, p.nameFirst, p.nameLast
ORDER BY career_length DESC, p.playerID ASC
LIMIT 10
"""

result = pd.read_sql_query(query, con)
print("Top 10 players with longest careers:")
result
```

```{python}
# Create a visualization of career lengths
from lets_plot import *

# Create a bar chart of the top 10 longest careers
chart = (ggplot(result, aes(x='career_length', y='playerID')) +
         geom_bar(stat='identity', fill='steelblue', alpha=0.7) +
         labs(title='Top 10 Players with Longest MLB Careers',
              x='Career Length (Years)',
              y='Player ID') +
         theme_minimal() +
         theme(axis_text_y=element_text(size=8)))

chart
```

```{python}
# Close the database connection
con.close()
```


